---
title: "next-optimized-images ã§ next/image ã£ã½ã„ã‚‚ã®ã‚’ã¤ãã‚‹"
emoji: "ğŸ–¼ï¸"
type: "tech"
topics:
  - "nextjs"
  - "react"
published: true
published_at: "2021-07-03 23:26"
---

next/image ã§ã®ç”»åƒæœ€é©åŒ–ãŒæœ€è¿‘ã®ãƒ›ãƒƒãƒˆãªãƒˆãƒ”ãƒƒã‚¯ã§ã¯ã‚ã‚Šã¾ã™ãŒã€è¦‹ãŸæ„Ÿã˜ã€next/imageã¯ç”»åƒã®æœ€é©åŒ–ã‚’ã‚µãƒ¼ãƒã‚µã‚¤ãƒ‰ã§å‡¦ç†ã™ã‚‹å‰æã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚ˆã†ã§ã™ã€‚

Next.jsã§ã‚µãƒ¼ãƒã‚’ç«‹ã¦ã‚‰ã‚Œã‚‹å ´åˆã¯ä½¿ã£ã¦ã„ããŸã„ã®ã§ã™ãŒã€å€‹äººçš„ã«æ¡ˆä»¶ã§ãã†ã„ã†æ§‹æˆã«ãªã£ã¦ã„ã‚‹ã“ã¨ã¯ã‚ã¾ã‚Šãªã„ã§ã™ã€‚
ãã“ã§ã€`next export` ã§ä½¿ãˆã‚‹ç”»åƒæœ€é©åŒ–ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦**next/imageã£ã½ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã£ã¦ã¿ã‚ˆã†**ã¨è€ƒãˆã¾ã—ãŸã€‚

ä¸€å¿œã€å…¬å¼ã® `next export` ã§ã® next/image ã®ä½¿ç”¨æ³•ã«ã¤ã„ã¦ã®ãƒšãƒ¼ã‚¸ã¯[ã“ã¡ã‚‰](https://nextjs.org/docs/messages/export-image-api) ã§ã™ã€‚

:::message
7/10ï¼š ä¸€éƒ¨ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’æ›¸ãå¿˜ã‚Œã¦ã„ãŸã®ã§è¿½åŠ ã€next.config.jsã«ã¤ã„ã¦ã‚‚è¿½è¨˜ã—ã¾ã—ãŸã€‚
:::

:::message
7/23: ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã¨ã‚¨ãƒ©ãƒ¼ãŒã§ã¦ã—ã¾ã†å•é¡Œã«ã¤ã„ã¦ã€æš«å®šã®è§£æ±ºç­–ã‚’è¿½è¨˜ã—ã¾ã—ãŸã€‚
:::

# å‰æ

ä»Šå›ã¯next/imageã®ã‚½ãƒ¼ã‚¹ã‚’è¦‹ã¦ã€ã»ã¼ãƒãƒ«ãƒ‘ã‚¯ãƒªãªæ„Ÿã˜ã§ã‚„ã£ã¦ã„ãã¾ã™ã€‚
IEå¯¾å¿œã¯ã—ã¾ã›ã‚“ã€‚
Next.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ 11.0.1ã§ã™ã€‚

# ã‚„ã‚‹ã“ã¨

 - webpå¯¾å¿œ / éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®å‡¦ç†
 - ç”»åƒã®srcSetã®ç”Ÿæˆ
 - é…å»¶èª­ã¿è¾¼ã¿
 - background-image ã®å¯¾å¿œ

ç”»åƒæœ€é©åŒ–ã¯ [next-optimized-images](https://github.com/cyrilwanner/next-optimized-images) ã€é…å»¶èª­ã¿è¾¼ã¿ã¯ æ™®é€šã«ï¼ˆnext/imageã«ãªã‚‰ã£ã¦ï¼‰Intersection Observerã§ã‚„ã£ã¦ã„ãã¾ã™ã€‚

# ãƒªãƒã‚¸ãƒˆãƒªã€ãƒ‡ãƒ¢URL

https://github.com/itomise/next-image-optimization-demo/blob/master/src/components/atoms/Image.tsx

https://next-image-optimization-demo.vercel.app/my-complete-img/

## ä½¿ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

[next-optimized-images](https://github.com/cyrilwanner/next-optimized-images) ã«ã¾ã¨ã¾ã£ã¦ã„ã¾ã™ãŒã€å„æ‹¡å¼µå­ã”ã¨ã«ä½¿ã†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’åˆ¥é€”ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
ä»Šå›ã¯ã€å…¨éƒ¨ã§ä»¥ä¸‹ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã—ãŸã€‚
- `next-optimized-images`
- `imagemin-mozjpeg`
- `imagemin-pngquant`
- `webp-loader`
- `responsive-loader`
- `sharp`
- `raw-loader`

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ä»¥ä¸‹ã‚³ãƒãƒ³ãƒ‰ã‚’ãŠä½¿ã„ãã ã•ã„

```bash
yarn add -D next-optimized-images imagemin-mozjpeg imagemin-pngquant webp-loader responsive-loader sharp raw-loader
```

#### next.config.js
next-optimized-imagesã®configã‚’ã“ã“ã§å®šç¾©ã—ã¦ã„ã¾ã™ã€‚
responsive-loaderã§ç”Ÿæˆã™ã‚‹ç”»åƒã‚µã‚¤ã‚ºã®ç¨®é¡ã‚’ä¸€æ‹¬ã§é©ç”¨ã§ãã¾ã™ã€‚
```js
const optimizedImagesConfig = {
  optimizeImagesInDev: true,
  removeOriginalExtension: true,
  responsive: {
    adapter: require('responsive-loader/sharp'),
    sizes: [640, 960, 1200, 1800],
  },
}
```

:::details pngã®æœ€é©åŒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¤ã„ã¦

next-optimized-imagesã®githubã§ã¯ imagemin-optipng ãŒæ¨å¥¨ã®ã‚ˆã†ãªæ„Ÿã˜ã«ãªã£ã¦ã„ã¾ã™ãŒï¼ˆimagepngquantãŒ alternative ã«ãªã£ã¦ã„ã‚‹ã®ã§ï¼‰ã€ã©ã£ã¡ã®ã»ã†ãŒã„ã„ã®ã‹ãªãƒ¼ã¨æ€ã£ã¦è»½ãæ¤œè¨¼ã—ã¦ã¿ã¾ã—ãŸã€‚

çµæœçš„ã«ã€
1. 2.51MBã®ç”»åƒï¼ˆç„¡åŠ å·¥ï¼‰
- imagemin-optipngï¼š1.5MB
- imagemin-pngquantï¼š721KB

2. 546KBã®ç”»åƒï¼ˆ1ã‚’Tinypngã®ã‚µã‚¤ãƒˆã§è»½é‡åŒ–ã—ãŸã‚‚ã®ï¼‰
- imagemin-optipngï¼š559KB
- imagemin-pngquantï¼š612KB

ã¨ã„ã†æ„Ÿã˜ã®çµæœã«ãªã‚Šã¾ã—ãŸã€‚
ç”»åƒã‚µã‚¤ã‚ºãŒå¤§ãã„ã¨ãã€optipngãŒpngquantã‚ˆã‚Šã‚‚2å€ãã‚‰ã„ã‚µã‚¤ã‚ºãŒå¤§ãããªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚
ã“ã®è¾ºã®ç”»åƒã®æœ€é©åŒ–ã«ã¤ã„ã¦èª¿ã¹ãŸã“ã¨ãŒãªãã‚ã¾ã‚Šè©•ä¾¡ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆãŒã‚ã‹ã‚‰ãªã‹ã£ãŸãŸã‚ã€optipngã¨pngquantã§ã©ã£ã¡ãŒã„ã„ã‹èª¿ã¹ã¦ã¿ãŸã¨ã“ã‚

https://www.saashub.com/compare-pngquant-vs-optipng
https://pointlessramblings.com/posts/pngquant-vs-pngcrush-vs-optipng-vs-pngnq/

ã®ã‚µã‚¤ãƒˆã§ pngquantã®ã»ã†ãŒã„ã„ã‚ˆãƒ¼çš„ãªã“ã¨ãŒæ›¸ã„ã¦ã‚ã£ãŸã®ã§ã€ä»Šå›ã¯ `imagemin-pngquant` ã®ã»ã†ã‚’æ¡ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
ï¼ˆå“è³ªãŒè½ã¡ã™ãã¦ã‚‹ãªã©ä»Šå¾Œæ°—ã¥ã„ãŸã‚Šã—ãŸã‚‰å¤‰ãˆã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ï¼‰

:::

:::details next-optimized-imagesã®responsive-loader ã®ä¸å…·åˆ

responsive-loader ã¯ç”»åƒã‚’ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ã§ã‚µã‚¤ã‚ºã‚’å¤‰ãˆã¦è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«è¤‡æ•°ã®ç”»åƒã‚’ç”Ÿæˆã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã™ãŒã€pngã®æœ€é©åŒ–ã¨ä½µç”¨ã§ããªã„ã¨ã„ã†ä¸å…·åˆãŒã‚ã‚‹ã£ã½ã„ã§ã™ã€‚
https://github.com/cyrilwanner/next-optimized-images/issues/179

webpã®å ´åˆã¯ååˆ†è»½é‡åŒ–ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªã®ã§å¤§ä¸ˆå¤«ãã†ã§ã—ãŸã€‚

â€»ä»¥ä¸‹ã€ç”»é¢å¹…ã§è¡¨ç¤ºã™ã‚‹ç”»åƒã‚µã‚¤ã‚ºã‚’è¤‡æ•°ç”¨æ„ã™ã‚‹æ–¹æ³•ã‚’ã€Œã‚µã‚¤ã‚ºã®æœ€é©åŒ–ã€ã€å˜ç´”ã«ç”»åƒã®å®¹é‡ã‚’è½ã¨ã™ã“ã¨ã‚’ã€Œç”»åƒã®æœ€é©åŒ–ã€ã¨è¨€ã†ã“ã¨ã«ã—ã¾ã™ã€‚ï¼ˆè¡¨ç¾ãŒã‚ã‹ã‚‰ãšï¼‰

ä½µç”¨ã™ã‚‹ã¨ã‚µã‚¤ã‚ºã®æœ€é©åŒ–ã¯ã—ã¦ãã‚Œã¦ã‚‚ç”»åƒã®æœ€é©åŒ–ã¯ã—ã¦ãã‚Œãªã„ã‚ˆã†ã«ãªã£ã¦ã€ç”»é¢å¹…ãŒå¤§ãã„ã¨ã‚‚ã¡ã‚ã‚“å…ƒã®ç”»åƒã‚µã‚¤ã‚ºã®ã¾ã¾ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚

ã ã£ãŸã‚‰ã€ã‚µã‚¤ã‚ºã®æœ€é©åŒ–ã¯ã‚„ã‚ã¦ç”»åƒã®æœ€é©åŒ–ã ã‘è¡Œã£ãŸã»ã†ãŒå®¹é‡ã¯å°ã•ããªã‚‹ã®ã§ã€

webpå¯¾å¿œã®å ´åˆï¼šã‚µã‚¤ã‚ºã®æœ€é©åŒ– & webpåŒ–
webpéå¯¾å¿œã®å ´åˆï¼š ç”»åƒã®æœ€é©åŒ–ã®ã¿

ã¨ã„ã†æ–¹æ³•ã§ã‚„ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚
ï¼ˆã¾ã˜ã§ Safari å…¨ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§webpå¯¾å¿œã—ã¦ãã‚Œï¼‰

:::

:::details webpack5ã«ã¤ã„ã¦

Next.js 11 ã‹ã‚‰webpack5ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ãªã£ãŸã®ã§ã™ãŒã€next-optimized-imagesã¯ã¾ã webpack5ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚
ä»Šå›è©¦ã—ã«ä¸Šã’ã¦ã¿ãŸã‚‰ãªã‚“ã¨ã‹å‹•ã„ãŸã®ã§ã€ä¸€æ—¦ã“ã®ã¾ã¾æ§˜å­ã‚’è¦‹ãŸã„ã¨æ€ã„ã¾ã™ã€‚

:::

:::details fontèª­ã¿è¾¼ã¿æ™‚ã®ä¸å…·åˆã«ã¤ã„ã¦(21/07/23è¿½è¨˜ï¼‰

[ã“ã¡ã‚‰](https://github.com/cyrilwanner/next-optimized-images/issues/144) ã« issueã§ä¸ŠãŒã£ã¦ã„ã¾ã™ãŒã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ next-optimized-images ã®webpack ãŒé€šã£ã¦ã—ã¾ã†ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚‚ã‚ãŒã£ã¦ã„ã¾ã™ãŒã€next.jsè‡ªä½“ã®configã«ä»¥ä¸‹ã®è¨˜è¿°ã‚’åŠ ãˆã¦ã€ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã¯ raw-loader ã‚’ä½¿ã†ã‚ˆã†ã«æŒ‡å®šã™ã‚‹ã“ã¨ã§è§£æ±ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚

```js
  webpack: (config) => {
    config.module.rules.push({
      test: /(\.ttf|\.otf|\.woff|\.woff2)$/,
      use: 'raw-loader',
    })
    return config
  },
```

:::


# webpå¯¾å¿œ / éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®å‡¦ç†ã€ç”»åƒã®srcSetã®ç”Ÿæˆ

`resize` ã§è¤‡æ•°ã‚µã‚¤ã‚ºç”Ÿæˆã€`format=webp`ã§webpåŒ–ãŒã§ãã¾ã™ã€‚
ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ `?webp` ã§ã™ãŒ responsive-loaderã®å ´åˆã¯ `format=webp`ã«ãªã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ï¼‰
webpã ã‘`resize`ãŒã¤ã„ã¦ã‚‹ã¨ã“ã‚ã«é–¢ã—ã¦ã¯ â†‘ã®ã€Œresponsive-loader ã®ä¸å…·åˆã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```ts
const webp = require(`../../../public${src}?resize&format=webp`)
const img = require(`../../../public${src}`)
```

pictureã‚¿ã‚°ã§äºŒã¤ã‚’å‡ºã—åˆ†ã‘ã‚‹ã“ã¨ã§ã€éå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã¯æ™®é€šã®imgã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

# é…å»¶èª­ã¿è¾¼ã¿

IntersectionObserverã®hooksã¯next/imageã¨å°‘ã—é•ã†ã®ã§ã™ãŒã€[ã“ã¡ã‚‰](https://usehooks-typescript.com/react-hook/use-intersection-observer) ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ï¼ˆå¯¾ã—ã¦å¤‰ã‚ã‚Šã¾ã›ã‚“ãŒï¼‰

è¡¨ç¤ºé ˜åŸŸã«ã¯ã„ã£ãŸã‚‰ã€imgã‚¿ã‚°ã®src attribute ã«urlã‚’å·®ã—è¾¼ã‚€å½¢ã§ã™ã€‚

```ts
const entry = useIntersectionObserver(ref, {
    rootMargin: '200px',
    freezeOnceVisible: true,
})

const isVisible = !isLazy || !!entry?.isIntersecting

// ...

let imgAttributes = {
    width,
    height,
    src:  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',
    srcSet: '',
}
let webpImgAttributes = {
srcSet: '',
}
if (isVisible) {
    imgAttributes = {
      ...imgAttributes,
      src: img,
    }
    webpImgAttributes = {
      srcSet: webp.srcSet,
    }
}

// ...

      <picture css={style.picture}>
        <source {...webpImgAttributes} type="image/webp" />
        <img
          {...rest}
          {...imgAttributes}
          decoding="async"
          alt=""
          className={className}
          ref={ref}
          style={imgStyle}
          css={style.img}
        />
      </picture>

```

# background-image ã®å¯¾å¿œ

### ã¾ãšã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ç”»åƒã®èª¬æ˜
next/imageã®å®Ÿè£…ã ã¨ã€padding-topã§é ˜åŸŸã‚’ç¢ºä¿ã™ã‚‹ç”¨ã®divã‚’ç”¨æ„ã—ã¦ imageã‚’absoluteã§ç½®ãã¨ã„ã†æ„Ÿã˜ã«ãªã£ã¦ã„ãŸã®ã§ã€åŒã˜ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚
next/imageã¨é•ã†ã¨ã“ã‚ã¯ã€ä¸€éƒ¨ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã§ã¯ãªã Emotion ã§ã€ã‚¯ãƒ©ã‚¹ã®ä»˜ã‘æ›¿ãˆã§è¡¨ç¾ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ï¼ˆãã£ã¡ã®ã»ã†ãŒã‚ã‹ã‚Šã‚„ã™ãã†ã ã£ãŸã®ã§ï¼‰

padding-topç”¨ã®`sizerStyle` ã¨ã„ã†styleã‚’ç”¨æ„ã—ã¦ã€backgroundç”¨ã®imageã§ã¯ãªã„å ´åˆã¯ã“ã¡ã‚‰ã§è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚

```ts
if (
    typeof widthInt !== 'undefined' &&
    typeof heightInt !== 'undefined' &&
    layout !== 'fill'
  ) {
    // default : <Image src="i.png" width="100" height="100" />
    const quotient = heightInt / widthInt
    const paddingTop = isNaN(quotient) ? '100%' : `${quotient * 100}%`
    sizerStyle = { display: 'block', boxSizing: 'border-box', paddingTop }
  }
```

### background-imageã®å ´åˆ

sizerStyleã‚’ãªãã™ã“ã¨ã«ã‚ˆã‚Šã€ãŸã ã® absolute ã® image ã«ãªã‚‹ã®ã§ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹å´ã®divã§ `position: relative` ã€ Heightã‚’ç¢ºä¿ã™ã‚‹ã“ã¨ã§backgrond-imageé¢¨ãªè¡¨ç¤ºã«ãªã£ã¦ã„ã¾ã™ã€‚
background-sizeã‚„background-positionãªã©ã¯ object-fit ã¨ object-positionã«ã‚ˆã‚Šèª¿æ•´ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚

```ts
// ...
        <div css={style.header}>
          <Image
            src={imgList[3]}
            layout="fill"
            objectFit="cover"
            objectPosition="center center"
          />
        </div>
// ...

const style = {
  header: css`
    position: relative;
    width: 100%;
    height: 320px;
  `,
}
```

# ãƒ‡ãƒ¢ã‚µã‚¤ãƒˆ
ä¸Šè¨˜ã§è¨˜è¼‰ã—ã¾ã—ãŸãŒã‚ã‚‰ãŸã‚ã¦ã€‚
vercelã«ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦ã¾ã™ã€‚
https://next-image-optimization-demo.vercel.app/

HTMLæ¨™æº–ã®æ©Ÿèƒ½ã§ img ã® loading attribute ã«ã¤ã„ã¦å°‘ã—æ°—ã«ãªã£ã¦ã„ãŸã®ã§æ¤œè¨¼ãŒã¦ã‚‰ãƒšãƒ¼ã‚¸ã‚’ä½œã£ã¦ã¿ã¦ã„ã¾ã™ã€‚
ã“ã‚ŒãŒæ¨™æº–åŒ–ã•ã‚Œã‚‹ã¨æ¥½ã§ã™ã­ã€‚


# æœ€å¾Œã«
å…¨ä½“çš„ã«ã ã„ã¶é›‘ã ã£ãŸã‚Šã€ã¾ã  `placeholder` ã§èª­ã¿è¾¼ã¿å‰ã« blurã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚„ã€ `priority` ã§ prefetchã—ã¦ãŠããŸã„ç”»åƒã¯ head å†…ã«æ›¸ã„ã¦ãŠãæ©Ÿèƒ½ã‚ãŸã‚Šã¯æ›¸ã„ã¦ã„ãªã„ã®ã§ã€ä»Šå¾Œè¿½åŠ ã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚
ãªã«ã‹é–“é•ã£ã¦ãŸã‚Šã—ãŸã‚‰æ•™ãˆã¦ãã ã•ã„ã€‚

# å‚è€ƒè¨˜äº‹

https://nextjs.org/docs/basic-features/image-optimization
https://coliss.com/articles/build-websites/operation/work/native-image-lazy-loading.html
https://spelldata.co.jp/blog/blog-2019-12-19.html
https://oriverk.dev/ja/posts/20200921-optimized-images/